(function(s,n){typeof exports=="object"&&typeof module!="undefined"?module.exports=n():typeof define=="function"&&define.amd?define(n):(s=typeof globalThis!="undefined"?globalThis:s||self,s.index=n())})(this,function(){"use strict";class s{constructor(t){this.options=Object.assign({loop:!1,delay:null},t||{}),this.activated=!1,this.EventCenter={change:[],ended:[]}}__Trigger(t,e=[]){Array.isArray(this.EventCenter[t])&&this.EventCenter[t].forEach(i=>{i(...e)})}on(t,e){Object.keys(this.EventCenter).indexOf(t)!==-1&&typeof e=="function"&&this.EventCenter[t].indexOf(e)===-1&&this.EventCenter[t].push(e)}off(t,e){if(t){if(Object.keys(this.EventCenter).indexOf(t)!==-1)if(typeof e=="function"){const i=this.EventCenter[t].indexOf(e);i!==-1&&this.EventCenter[t].splice(i,1)}else this.EventCenter[t]=[]}else Object.keys(this.EventCenter).forEach(i=>{this.EventCenter[i]=[]})}loadAction(t){Array.isArray(t)?(this.pause(),this.actions=t,this.stepIndex=-1):console.warn("loadAction(): \u53C2\u6570\u683C\u5F0F\u4E0D\u6B63\u786E")}inertAction(t){Array.isArray(t)?Array.isArray(this.actions)?(this.activated&&this.pause(!0),this.actions.splice(this.stepIndex,0,...t),this.play()):console.warn("Director\u5B9E\u4F8B\u672A\u521D\u59CB\u5316"):console.warn("inertAction(): \u53C2\u6570\u683C\u5F0F\u4E0D\u6B63\u786E")}moveNext(){this.pause(),this.stepIndex<this.actions.length-1?this.stepIndex++:this.options.loop&&(this.stepIndex=0),this.play()}movePrev(){this.pause(),this.stepIndex>0?this.stepIndex--:this.options.loop&&(this.stepIndex=this.actions.length-1),this.play()}moveTo(t){if(isNaN(parseInt(t)))return null;this.pause(),t>-1&&t<this.actions.length&&(this.stepIndex=t),this.play()}play(){if(this.activated)return null;this.activated=!0;const t=()=>{if(!Array.isArray(this.actions)||isNaN(parseInt(this.stepIndex)))return null;(!(this.stepIndex>=0)||this.stepIndex>this.actions.length-1)&&(this.stepIndex=0);const e=this.actions[this.stepIndex];typeof e.action=="function"&&e.action();const i=parseInt(e.delay===void 0?this.options.delay:e.delay);this.activated=!isNaN(i);const h=()=>{this.__Trigger("change",[this.activated,this.stepIndex]),this.activated?(this.stepIndex++,this.timer=setTimeout(()=>{t()},i)):this.timer=clearTimeout(this.timer)};this.stepIndex<this.actions.length-1?h():this.options.loop?(this.stepIndex=-1,h()):(this.stop(),this.__Trigger("ended"))};t()}pause(t){this.activated&&(this.activated=!1,this.timer=clearTimeout(this.timer),!t&&this.__Trigger("change",[this.activated,this.stepIndex]))}stop(){this.pause(),this.stepIndex=-1}destroy(){this.pause(),this.stepIndex=null,this.actions=null}}return s});
